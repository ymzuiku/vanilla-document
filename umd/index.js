!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).vanilly={})}(this,function(e){"use strict";function t(){return"onpopstate"in o&&"pushState"in i&&"function"==typeof i.pushState&&"replaceState"in i&&"function"==typeof i.replaceState}function n(){return"state"in i}var o,r,i;[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach(function(e){e.hasOwnProperty("remove")||Object.defineProperty(e,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode.removeChild(this)}})}),[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach(function(e){e.hasOwnProperty("append")||Object.defineProperty(e,"append",{configurable:!0,enumerable:!0,writable:!0,value:function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];e.forEach(function(e){t.appendChild(e)})}})}),o=window,r={},i=o.history,r.polyfill=function(){if(t())n()||(i.state=null,o.addEventListener("popstate",function(e){i.state=e.state}),function(){var e=i.__proto__,t=e.pushState,n=e.replaceState;e.pushState=function(){t.apply(this,arguments),this.state=arguments[0]},e.replaceState=function(){n.apply(this,arguments),this.state=arguments[0]}}());else{var e=o.console&&(console.error||console.warn||console.log);"function"==typeof e&&e("[history.state] This browser doesn't support History APIs. Cannot fulfill polyfill.")}},r.isSupported=function(){return t()&&n()},r.__hasHistoryAPI=t,r.__hasHistoryState=n;var a="vanilly-onupdate",s="vanilly-onappend",l="vanilly-onremove",v=function(){return(v=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function u(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function _(e,t){if(!e)return null;for(var n,o=/([^=?&]+)=?([^&]*)/g,r={};n=o.exec(e);){var i=u(n[1]),a=u(n[2]);null===i||null===a||i in r||(t||(a=isNaN(Number(a))?a:Number(a)),r[i]=a)}return r}function y(e,t){void 0===t&&(t="");var n,o,r=[];for(o in"string"!=typeof t&&(t="?"),e)if(Object.prototype.hasOwnProperty.call(e,o)){if((n=e[o])||null!=n&&!isNaN(n)||(n=""),o=encodeURIComponent(o),n=encodeURIComponent(n),null===o||null===n)continue;r.push(o+"="+n)}return r.length?t+r.join("&"):""}function p(s){function l(e,t){var n=e+t;if(d.has(n))return d.get(n);var o=e&&e.split("/"),r=t&&t.split("/");if(!r||!o)return d.set(n,!1),!1;var i=!0;return o.forEach(function(e,t){"*"!==e&&e!==r[t]&&(i=!1)}),d.set(n,i),i}function a(){if(0<window.location.hash.length){var e=window.location.hash.split("?"),t=e[0],n=e[1],o=void 0===n?"":n;return[t.replace(f,""),o]}return[window.location.pathname,window.location.search||""]}function u(e,t){for(var n=0,o=r;n<o.length;n++){(0,o[n])(e,t,s.getState())}}function p(o,r,i){o!==s.getState().paths[s.getState().paths.length-1]&&(s.update(function(e){e.paths.push(o);var t=v({},e.history[o],r);if(e.history[o]=t,"undefined"!=typeof window&&!i&&!h){var n=y(t);window.history.pushState(null,""+f+o,""===n?""+f+o:""+f+o+"?"+n)}}),u(o,r))}function i(e,n){var t=s.getState(),o="number"==typeof e?e:t.paths.length-1,r=t.paths[o-1],i=t.history[r];s.update(function(e){for(var t=0;t<e.paths.length-o;t++)n||window.history.back(),e.history[r]={},e.paths.pop()}),u(r,i)}var d=new Map,c=new Map,f="",h=!1,r=[];if("undefined"!=typeof window){window.addEventListener("popstate",function(){var e=s.getState().paths;if(a()[0]!==e[e.length-1]){var n=!1;if(e.forEach(function(e,t){e===a()[0]&&(n=!0)}),n)i(void 0,!0);else{var t=a(),o=t[0],r=t[1];p(o,""!==r?_(r):void 0,!0)}}else u(a()[0],void 0)})}return{checkPathMatch:function(e){var t=s.getState().paths,n=e+":"+t.join(",");if(c.has(n))return c.get(n);for(var o=!1,r=0,i=0;i<t.length;i++){l(e,t[i])&&(r=i,o=!0)}var a=[l(e,t[t.length-1]),o,r];return c.set(n,a),a},init:function(e,t,n){if(void 0===n&&(n="#"),h=t||!1,f=n,s.update(function(e){e.paths=[],e.history=v({},e.history)}),"undefined"!=typeof window){var o=a(),r=o[0],i=_(o[1]);"/"===r||r===e?p(e,i):(p(e),p(r,i))}},listen:function(e){r.push(e)},pop:i,push:p,replace:function(o,r){var e=s.getState(),i=o||e.paths[e.paths.length-1];s.update(function(e){var t=v({},e.history[o],r);if(e.history[o]=t,e.paths[e.paths.length-1]=i,"undefined"!=typeof window){var n=y(t);window.history.replaceState(null,""+f+i,""===n?""+f+i:""+f+i+"?"+n)}}),u(i,r)}}}var h="block",m="block",g="absolute",w="auto",C="none";var b,d={__listenFns:new Set,__listenNodes:new Set,__state:{},mutationObserver:function(e){return e},middleware:{update:[],getState:[]},getState:function(){return 0<d.middleware.getState.length&&d.middleware.getState.forEach(function(e){d.__state=e(d.__state)}),d.__state},update:function(e){0<d.middleware.update.length&&d.middleware.update.forEach(function(e){d.__state=e(d.__state)});var t=e(d.__state);t&&(d.__state=t),d.__listenFns.forEach(function(e){var t=e(d.__state);t&&(d.__state=t)}),d.__listenNodes.forEach(function(e){if(e&&e.__onMemo&&e.__onUpdate){var t=e.__onMemo(d.__state);e.__lastMemo!==t&&(e.__onUpdate(t||[],e),e.__lastMemo=t)}})},listen:function(e){d.__listenFns.has(e)||d.__listenFns.add(e)}},c={routeManage:b=p(d),Route:function(e){var a=e.path,s=e.component,l=e.delay,t=e.keep,u=void 0===t||t,p=e.leaveTime,d=M("div");d.setAttribute("route",a),d.setStyle({width:"100%",height:"100%",overflow:"hidden",left:"0px",top:"0px",backgroundColor:"#fff",pointerEvents:C,display:m,position:g,zIndex:1});var c={animeTimer:null,unListen:null,isRenderChild:!1,style:{},realChild:null},f=function(){var e=b.checkPathMatch(a),t=e[0],n=e[1],o=e[2];if(t)c.realChild||(void 0===l?(c.realChild=s(),d.innerHTML("").append(c.realChild),f()):s().then(function(e){c.realChild=e(),d.innerHTML("").append(c.realChild),f()})),c.isRenderChild=!0,c.style={pointerEvents:w,display:h,position:"relative",zIndex:3},d.setStyle(c.style);else{var r=u&&n,i=c.isRenderChild;void 0!==c.isRenderChild&&!0!==c.isRenderChild||(0<o&&p&&0<p?(c.style={pointerEvents:w,display:h,position:g,zIndex:h},d.setStyle(c.style),setTimeout(function(){c.isRenderChild=r,c.style={pointerEvents:C,display:m,position:g,zIndex:1},d.setStyle(c.style),i&&!c.isRenderChild?d.innerHTML(""):i||d.innerHTML("").append(c.realChild)},p)):(c.isRenderChild=r,c.style={pointerEvents:C,display:m,position:g,zIndex:0<o?2:1},d.setStyle(c.style),i&&!c.isRenderChild?d.innerHTML(""):i||d.innerHTML("").append(c.realChild)))}};return d.onAppend(function(){c.unListen=b.listen(f)}),d.onRemove(function(){c.unListen&&c.unListen(),c.realChild=null,c.animeTimer=null}),d}},f=c.Route,S=c.routeManage;function E(o){var r={__isChain:!0,target:o,ref:function(e){return e(o),r},addEventListener:function(e,t,n){return o.addEventListener(e,t,n),r},removeEventListener:function(e,t,n){o.removeEventListener(e,t,n)},innerText:function(e){return o.innerText=e,r},innerHTML:function(e){return o.innerHTML=e,r},textContent:function(e){return o.textContent=e,r},children:function(e){for(var t=[],n=0;n<o.children.length;n++)t.push(o.children.item(n));e(t)},clearChildren:function(){for(var e=0;e<o.children.length;e++){E(o.children.item(e)).remove()}return r},removeChild:function(e){for(var t=0;t<o.children.length;t++){var n=o.children.item(t);e(n,t)&&E(n).remove()}},remove:function(){return r.clearChildren(),o.__onRemove&&(o.__onRemove(o.__lastMemo,o),d.__listenNodes.delete(o)),o.remove(),r},append:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.forEach(function(e){if(e){var t=e.__isChain?e.target:e;t.__onAppend&&t.__onAppend(t.__lastMemo,t),t.__onUpdate&&(d.__listenNodes.has(t)||d.__listenNodes.add(t)),o.appendChild(t)}}),r},setProps:function(t){return Object.keys(t).forEach(function(e){o[e]=t[e]}),r},setAttribute:function(e,t){return o.setAttribute(e,t),r},removeAttribute:function(e){return o.removeAttribute(e),r},cssText:function(e){return o.style.cssText=e,r},setClass:function(e){return o.setAttribute("class",e),r},setStyle:function(t){return Object.keys(t).forEach(function(e){o.style[e]=t[e]}),r},onUpdate:function(e,t){return o.__onMemo=e,o.__onUpdate=t,o.setAttribute(a,"1"),r},onAppend:function(e){return o.__onAppend=e,o.setAttribute(s,"1"),r},onRemove:function(e){return o.__onRemove=e,o.setAttribute(l,"1"),r}};return r}var M=function(e,t){return E(document.createElement(e,t))};e.DOM=M,e.Route=f,e.routeManage=S,e.store=d,e.toDOM=E,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=index.js.map
