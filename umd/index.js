!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).vanilly={})}(this,function(e){"use strict";void 0===window.history&&(window.history={}),void 0===window.history.pushState&&(window.history.pushState=function(){window.history.length+=1}),void 0===window.history.replaceState&&(window.history.replaceState=function(){}),void 0===window.history.back&&(window.history.back=function(){window.history.length-=1}),void 0===window.history.forward&&(window.history.forward=function(){}),void 0===window.history.go&&(window.history.go=function(){}),void 0===window.history.length&&(window.history.length=0),void 0===window.history.state&&(window.history.state={}),void 0===window.history.scrollRestoration&&(window.history.scrollRestoration=function(){}),[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach(function(e){e.hasOwnProperty("remove")||Object.defineProperty(e,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode.removeChild(this)}})}),[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach(function(e){e.hasOwnProperty("append")||Object.defineProperty(e,"append",{configurable:!0,enumerable:!0,writable:!0,value:function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];e.forEach(function(e){t.appendChild(e)})}})});var n="vanilly-onupdate",t="vanilly-onappend",r="vanilly-onmount",a="vanilly-onremove",m=function(){return(m=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function s(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function v(e,t){if(!e)return null;for(var n,i=/([^=?&]+)=?([^&]*)/g,o={};n=i.exec(e);){var r=s(n[1]),a=s(n[2]);null===r||null===a||r in o||(t||(a=isNaN(Number(a))?a:Number(a)),o[r]=a)}return o}function w(e,t){void 0===t&&(t="");var n,i,o=[];for(i in"string"!=typeof t&&(t="?"),e)if(Object.prototype.hasOwnProperty.call(e,i)){if((n=e[i])||null!=n&&!isNaN(n)||(n=""),i=encodeURIComponent(i),n=encodeURIComponent(n),null===i||null===n)continue;o.push(i+"="+n)}return o.length?t+o.join("&"):""}function i(s){function d(e,t){var n=e+t;if(c.has(n))return c.get(n);var i=e&&e.split("/"),o=t&&t.split("/");if(!o||!i)return c.set(n,!1),!1;var r=!0;return i.forEach(function(e,t){"*"!==e&&e!==o[t]&&(r=!1)}),c.set(n,r),r}function a(){if(0<window.location.hash.length){var e=window.location.hash.split("?"),t=e[0],n=e[1],i=void 0===n?"":n;return[t.replace(p,""),i]}return[window.location.pathname,window.location.search||""]}function l(e,t){for(var n=0,i=o;n<i.length;n++){(0,i[n])(e,t,s.getState())}}function u(i,o,r){i!==s.getState().paths[s.getState().paths.length-1]&&(s.update(function(e){e.paths.push(i);var t=m({},e.history[i],o);if(e.history[i]=t,"undefined"!=typeof window&&!r&&!f){var n=w(t);window.history.pushState(null,""+p+i,""===n?""+p+i:""+p+i+"?"+n)}}),l(i,o))}function r(e,n){var t=s.getState(),i="number"==typeof e?e:t.paths.length-1,o=t.paths[i-1],r=t.history[o];s.update(function(e){for(var t=0;t<e.paths.length-i;t++)n||window.history.back(),e.history[o]={},e.paths.pop()}),l(o,r)}var c=new Map,h=new Map,p="",f=!1,o=[];if("undefined"!=typeof window){window.addEventListener("popstate",function(){var e=s.getState().paths;if(a()[0]!==e[e.length-1]){var n=!1;if(e.forEach(function(e,t){e===a()[0]&&(n=!0)}),n)r(void 0,!0);else{var t=a(),i=t[0],o=t[1];u(i,""!==o?v(o):void 0,!0)}}else l(a()[0],void 0)})}return{checkPathMatch:function(e){var t=s.getState().paths,n=e+":"+t.join(",");if(h.has(n))return h.get(n);for(var i=!1,o=0,r=0;r<t.length;r++){d(e,t[r])&&(o=r,i=!0)}var a=[d(e,t[t.length-1]),i,o];return h.set(n,a),a},init:function(e,t,n){if(void 0===n&&(n="#"),f=t||!1,p=n,s.update(function(e){e.paths=[],e.history=m({},e.history)}),"undefined"!=typeof window){var i=a(),o=i[0],r=v(i[1]);"/"===o||o===e?u(e,r):(u(e),u(o,r))}},listen:function(e){o.push(e)},pop:r,push:u,replace:function(i,o){var e=s.getState(),r=i||e.paths[e.paths.length-1];s.update(function(e){var t=m({},e.history[i],o);if(e.history[i]=t,e.paths[e.paths.length-1]=r,"undefined"!=typeof window){var n=w(t);window.history.replaceState(null,""+p+r,""===n?""+p+r:""+p+r+"?"+n)}}),l(r,o)}}}var f="block",y="block",_="absolute",g="auto",b="none";var C,d={__listenFns:new Set,__listenNodes:new Set,__state:{},mutationObserver:function(e){return e},middleware:{update:[],getState:[]},getState:function(){return 0<d.middleware.getState.length&&d.middleware.getState.forEach(function(e){d.__state=e(d.__state)}),d.__state},update:function(e){0<d.middleware.update.length&&d.middleware.update.forEach(function(e){d.__state=e(d.__state)});var t=e(d.__state);t&&(d.__state=t),d.__listenFns.forEach(function(e){var t=e(d.__state);t&&(d.__state=t)}),d.__listenNodes.forEach(function(e){if(e&&e.__onMemo&&e.__onUpdate){var t=e.__onMemo(d.__state);e.__lastMemo!==t&&(e.__onUpdate(t||[],e),e.__lastMemo=t)}})},listen:function(e){d.__listenFns.has(e)||d.__listenFns.add(e)}},o={routeManage:C=i(d),Route:function(e){var a=e.path,s=e.component,d=e.delay,t=e.keep,l=void 0===t||t,u=e.leaveTime,c=O("div");c.setAttribute("route",a),c.style({width:"100%",height:"100%",overflow:"hidden",left:"0px",top:"0px",backgroundColor:"#fff",pointerEvents:b,display:y,position:_,zIndex:1});var h={animeTimer:null,unListen:null,isRenderChild:!1,style:{},realChild:null},p=function(){var e=C.checkPathMatch(a),t=e[0],n=e[1],i=e[2];if(t)h.realChild||(void 0===d?(h.realChild=s(),c.innerHTML("").append(h.realChild),p()):s().then(function(e){h.realChild=e(),c.innerHTML("").append(h.realChild),p()})),h.isRenderChild=!0,h.style={pointerEvents:g,display:f,position:"relative",zIndex:3},c.style(h.style);else{var o=l&&n,r=h.isRenderChild;void 0!==h.isRenderChild&&!0!==h.isRenderChild||(0<i&&u&&0<u?(h.style={pointerEvents:g,display:f,position:_,zIndex:f},c.style(h.style),setTimeout(function(){h.isRenderChild=o,h.style={pointerEvents:b,display:y,position:_,zIndex:1},c.style(h.style),r&&!h.isRenderChild?c.innerHTML(""):r||c.innerHTML("").append(h.realChild)},u)):(h.isRenderChild=o,h.style={pointerEvents:b,display:y,position:_,zIndex:0<i?2:1},c.style(h.style),r&&!h.isRenderChild?c.innerHTML(""):r||c.innerHTML("").append(h.realChild)))}};return c.onAppend(function(){h.unListen=C.listen(p)}),c.onRemove(function(){h.unListen&&h.unListen(),h.realChild=null,h.animeTimer=null}),c}},l=o.Route,u=o.routeManage,c=navigator.userAgent,h=/(?:Android)/.test(c),p=/(?:Firefox)/.test(c),x=/(?:Chrome|CriOS)/.test(c),M=/(?:iPad|PlayBook)/.test(c)||h&&!/(?:Mobile)/.test(c)||p&&/(?:Tablet)/.test(c),E=/(?:iPhone)/.test(c)&&!M,R=/MicroMessenger/.test(c),S=!E&&!h,T=new Set,A={"@media-sm":"@media (min-width: 640px)","@media-md":"@media (min-width: 768px)","@media-lg":"@media (min-width: 1024px)","@media-xl":"@media (min-width: 1280px)","@media-ios":"@media (min-width: "+(E?"0px":"9999px")+")","@media-android":"@media (min-width: "+(h?"0px":"9999px")+")","@media-pc":"@media (min-width: "+(S?"0px":"9999px")+")","@media-phone":"@media (min-width: "+(S?"9999px":"0px")+")","@media-wechat":"@media (min-width: "+(R?"9999px":"0px")+")","@media-pad":"@media (min-width: "+(M?"9999px":"0px")+")"};function L(o){var i={__isChain:!0,element:o,ref:function(e){return e(i),i},addEventListener:function(e,t,n){return o.addEventListener(e,t,n),i},removeEventListener:function(e,t,n){return o.removeEventListener(e,t,n),i},innerText:function(e){return o.innerText=e,i},innerHTML:function(e){return o.innerHTML=e,i},textContent:function(e){return o.textContent=e,i},children:function(e){for(var t=[],n=0;n<o.children.length;n++)t.push(o.children.item(n));return e(t),i},clearChildren:function(){for(var e=0;e<o.children.length;e++){L(o.children.item(e)).remove()}return i},removeChild:function(e){for(var t=0;t<o.children.length;t++){var n=o.children.item(t);e(n,t)&&L(n).remove()}return i},remove:function(){return i.clearChildren(),o.__onRemove&&(o.__onRemove(o.__lastMemo,o),d.__listenNodes.delete(o)),o.remove(),i},append:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.forEach(function(e){if(e){var t=e.__isChain?e.element:e;if(t.__onUpdate&&(d.__listenNodes.has(t)||d.__listenNodes.add(t)),o.appendChild(t),t.__onAppend&&t.__onAppend(t.__lastMemo,t),t.__onRendered){t.id||(t.id=Math.random().toString(16).slice(2));var n=0,i=function(){n++,document.getElementById(t.id)?t.__onRendered(t.__lastMemo,t):n<100&&setTimeout(i,40)};setTimeout(i,40)}}}),i},setProps:function(t){return Object.keys(t).forEach(function(e){o[e]=t[e]}),i},setAttribute:function(e,t){return o.setAttribute(e,t),i},removeAttribute:function(e){return o.removeAttribute(e),i},cssText:function(e){return o.style.cssText=e,i},css:function(t){if(!T.has(t)){var e=document.createElement("style");-1<t.indexOf("@media-")&&Object.keys(A).forEach(function(e){t=t.replace(e,A[e])}),e.textContent=t,console.log(t),document.head.appendChild(e)}return i},class:function(e){return o.setAttribute("class",e),i},updateClass:function(e){if("string"==typeof e)o.setAttribute("class",(o.className||"")+e);else{var t=e(o.className||"");o.setAttribute("class",t)}return i},style:function(t){return Object.keys(t).forEach(function(e){o.style[e]=t[e]}),i},onUpdate:function(e,t){return o.__onMemo=e,o.__onUpdate=t,o.setAttribute(n,"1"),i},onAppend:function(e){return o.__onAppend=e,o.setAttribute(t,"1"),i},onRendered:function(e){return o.__onRendered=e,o.setAttribute(r,"1"),i},onRemove:function(e){return o.__onRemove=e,o.setAttribute(a,"1"),i}};return i}var O=function(e,t){return L("string"!=typeof e?e:document.createElement(e,t))};e.DOM=O,e.Route=l,e.isAndroid=h,e.isChrome=x,e.isFireFox=p,e.isIos=E,e.isPad=M,e.isPc=S,e.isWechat=R,e.routeManage=u,e.store=d,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=index.js.map
