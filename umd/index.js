!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).vanilly={})}(this,function(e){"use strict";void 0===window.history&&(window.history={}),void 0===window.history.pushState&&(window.history.pushState=function(){window.history.length+=1}),void 0===window.history.replaceState&&(window.history.replaceState=function(){}),void 0===window.history.back&&(window.history.back=function(){window.history.length-=1}),void 0===window.history.forward&&(window.history.forward=function(){}),void 0===window.history.go&&(window.history.go=function(){}),void 0===window.history.length&&(window.history.length=0),void 0===window.history.state&&(window.history.state={}),void 0===window.history.scrollRestoration&&(window.history.scrollRestoration=function(){}),[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach(function(e){e.hasOwnProperty("remove")||Object.defineProperty(e,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode.removeChild(this)}})}),[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach(function(e){e.hasOwnProperty("append")||Object.defineProperty(e,"append",{configurable:!0,enumerable:!0,writable:!0,value:function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];e.forEach(function(e){t.appendChild(e)})}})});var n="vanilly-onupdate",t="vanilly-onappend",r="vanilly-onremove",v=function(){return(v=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function s(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function y(e,t){if(!e)return null;for(var n,o=/([^=?&]+)=?([^&]*)/g,i={};n=o.exec(e);){var r=s(n[1]),a=s(n[2]);null===r||null===a||r in i||(t||(a=isNaN(Number(a))?a:Number(a)),i[r]=a)}return i}function w(e,t){void 0===t&&(t="");var n,o,i=[];for(o in"string"!=typeof t&&(t="?"),e)if(Object.prototype.hasOwnProperty.call(e,o)){if((n=e[o])||null!=n&&!isNaN(n)||(n=""),o=encodeURIComponent(o),n=encodeURIComponent(n),null===o||null===n)continue;i.push(o+"="+n)}return i.length?t+i.join("&"):""}function o(s){function l(e,t){var n=e+t;if(c.has(n))return c.get(n);var o=e&&e.split("/"),i=t&&t.split("/");if(!i||!o)return c.set(n,!1),!1;var r=!0;return o.forEach(function(e,t){"*"!==e&&e!==i[t]&&(r=!1)}),c.set(n,r),r}function a(){if(0<window.location.hash.length){var e=window.location.hash.split("?"),t=e[0],n=e[1],o=void 0===n?"":n;return[t.replace(p,""),o]}return[window.location.pathname,window.location.search||""]}function u(e,t){for(var n=0,o=i;n<o.length;n++){(0,o[n])(e,t,s.getState())}}function d(o,i,r){o!==s.getState().paths[s.getState().paths.length-1]&&(s.update(function(e){e.paths.push(o);var t=v({},e.history[o],i);if(e.history[o]=t,"undefined"!=typeof window&&!r&&!f){var n=w(t);window.history.pushState(null,""+p+o,""===n?""+p+o:""+p+o+"?"+n)}}),u(o,i))}function r(e,n){var t=s.getState(),o="number"==typeof e?e:t.paths.length-1,i=t.paths[o-1],r=t.history[i];s.update(function(e){for(var t=0;t<e.paths.length-o;t++)n||window.history.back(),e.history[i]={},e.paths.pop()}),u(i,r)}var c=new Map,h=new Map,p="",f=!1,i=[];if("undefined"!=typeof window){window.addEventListener("popstate",function(){var e=s.getState().paths;if(a()[0]!==e[e.length-1]){var n=!1;if(e.forEach(function(e,t){e===a()[0]&&(n=!0)}),n)r(void 0,!0);else{var t=a(),o=t[0],i=t[1];d(o,""!==i?y(i):void 0,!0)}}else u(a()[0],void 0)})}return{checkPathMatch:function(e){var t=s.getState().paths,n=e+":"+t.join(",");if(h.has(n))return h.get(n);for(var o=!1,i=0,r=0;r<t.length;r++){l(e,t[r])&&(i=r,o=!0)}var a=[l(e,t[t.length-1]),o,i];return h.set(n,a),a},init:function(e,t,n){if(void 0===n&&(n="#"),f=t||!1,p=n,s.update(function(e){e.paths=[],e.history=v({},e.history)}),"undefined"!=typeof window){var o=a(),i=o[0],r=y(o[1]);"/"===i||i===e?d(e,r):(d(e),d(i,r))}},listen:function(e){i.push(e)},pop:r,push:d,replace:function(o,i){var e=s.getState(),r=o||e.paths[e.paths.length-1];s.update(function(e){var t=v({},e.history[o],i);if(e.history[o]=t,e.paths[e.paths.length-1]=r,"undefined"!=typeof window){var n=w(t);window.history.replaceState(null,""+p+r,""===n?""+p+r:""+p+r+"?"+n)}}),u(r,i)}}}var f="block",_="block",m="absolute",g="auto",b="none";var C,a={__listenFns:new Set,__listenNodes:new Set,__state:{},mutationObserver:function(e){return e},middleware:{update:[],getState:[]},getState:function(){return 0<a.middleware.getState.length&&a.middleware.getState.forEach(function(e){a.__state=e(a.__state)}),a.__state},update:function(e){0<a.middleware.update.length&&a.middleware.update.forEach(function(e){a.__state=e(a.__state)});var t=e(a.__state);t&&(a.__state=t),a.__listenFns.forEach(function(e){var t=e(a.__state);t&&(a.__state=t)}),a.__listenNodes.forEach(function(e){if(e&&e.__onMemo&&e.__onUpdate){var t=e.__onMemo(a.__state);e.__lastMemo!==t&&(e.__onUpdate(t||[],e),e.__lastMemo=t)}})},listen:function(e){a.__listenFns.has(e)||a.__listenFns.add(e)}},i={routeManage:C=o(a),Route:function(e){var a=e.path,s=e.component,l=e.delay,t=e.keep,u=void 0===t||t,d=e.leaveTime,c=E("div");c.setAttribute("route",a),c.setStyle({width:"100%",height:"100%",overflow:"hidden",left:"0px",top:"0px",backgroundColor:"#fff",pointerEvents:b,display:_,position:m,zIndex:1});var h={animeTimer:null,unListen:null,isRenderChild:!1,style:{},realChild:null},p=function(){var e=C.checkPathMatch(a),t=e[0],n=e[1],o=e[2];if(t)h.realChild||(void 0===l?(h.realChild=s(),c.innerHTML("").append(h.realChild),p()):s().then(function(e){h.realChild=e(),c.innerHTML("").append(h.realChild),p()})),h.isRenderChild=!0,h.style={pointerEvents:g,display:f,position:"relative",zIndex:3},c.setStyle(h.style);else{var i=u&&n,r=h.isRenderChild;void 0!==h.isRenderChild&&!0!==h.isRenderChild||(0<o&&d&&0<d?(h.style={pointerEvents:g,display:f,position:m,zIndex:f},c.setStyle(h.style),setTimeout(function(){h.isRenderChild=i,h.style={pointerEvents:b,display:_,position:m,zIndex:1},c.setStyle(h.style),r&&!h.isRenderChild?c.innerHTML(""):r||c.innerHTML("").append(h.realChild)},d)):(h.isRenderChild=i,h.style={pointerEvents:b,display:_,position:m,zIndex:0<o?2:1},c.setStyle(h.style),r&&!h.isRenderChild?c.innerHTML(""):r||c.innerHTML("").append(h.realChild)))}};return c.onAppend(function(){h.unListen=C.listen(p)}),c.onRemove(function(){h.unListen&&h.unListen(),h.realChild=null,h.animeTimer=null}),c}},l=i.Route,u=i.routeManage;function d(o){var i={__isChain:!0,target:o,ref:function(e){return e(i),i},addEventListener:function(e,t,n){return o.addEventListener(e,t,n),i},removeEventListener:function(e,t,n){return o.removeEventListener(e,t,n),i},innerText:function(e){return o.innerText=e,i},innerHTML:function(e){return o.innerHTML=e,i},textContent:function(e){return o.textContent=e,i},children:function(e){for(var t=[],n=0;n<o.children.length;n++)t.push(o.children.item(n));return e(t),i},clearChildren:function(){for(var e=0;e<o.children.length;e++){d(o.children.item(e)).remove()}return i},removeChild:function(e){for(var t=0;t<o.children.length;t++){var n=o.children.item(t);e(n,t)&&d(n).remove()}return i},remove:function(){return i.clearChildren(),o.__onRemove&&(o.__onRemove(o.__lastMemo,o),a.__listenNodes.delete(o)),o.remove(),i},append:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.forEach(function(e){if(e){var t=e.__isChain?e.target:e;t.__onAppend&&t.__onAppend(t.__lastMemo,t),t.__onUpdate&&(a.__listenNodes.has(t)||a.__listenNodes.add(t)),o.appendChild(t)}}),i},setProps:function(t){return Object.keys(t).forEach(function(e){o[e]=t[e]}),i},setAttribute:function(e,t){return o.setAttribute(e,t),i},removeAttribute:function(e){return o.removeAttribute(e),i},cssText:function(e){return o.style.cssText=e,i},setClass:function(e){return o.setAttribute("class",e),i},updateClass:function(e){var t=e(o.className||"");return o.setAttribute("class",t),i},setStyle:function(t){return Object.keys(t).forEach(function(e){o.style[e]=t[e]}),i},onUpdate:function(e,t){return o.__onMemo=e,o.__onUpdate=t,o.setAttribute(n,"1"),i},onAppend:function(e){return o.__onAppend=e,o.setAttribute(t,"1"),i},onRemove:function(e){return o.__onRemove=e,o.setAttribute(r,"1"),i}};return i}var E=function(e,t){return d("string"!=typeof e?e:document.createElement(e,t))};e.DOM=E,e.Route=l,e.routeManage=u,e.store=a,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=index.js.map
