!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("immer")):"function"==typeof define&&define.amd?define(["exports","immer"],t):t((e=e||self).vanilly={},e.immer)}(this,function(e,n){"use strict";n=n&&n.hasOwnProperty("default")?n.default:n;var o={listens:new Set,addListen:function(e){return o.listens.has(e)||o.listens.add(e),function(){o.listens.delete(e)}},_state:{history:{}},getState:function(){return o._state},update:function(t){o._state=n(o._state,function(e){t(e)}),o.listens.forEach(function(e){if(!e.isStopUpdate)if(e.onMemo){for(var t=e.onMemo(o._state),n=!1,i=0;i<e.lastMemo.length;i++)if(e.lastMemo[i]!==t[i]){n=!0;break}n&&(e.lastMemo=t,e.onUpdate&&e.onUpdate(e.lastMemo))}else e.onUpdate(e.lastMemo)})}};function i(e){e&&"object"==typeof e&&!e.$cache&&(e.$cache={},e.$cache.childs=new Set)}window.__isRewrite=!1,[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach(function(e){e.hasOwnProperty("remove")||Object.defineProperty(e,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode.removeChild(this)}})});!function(){if(!window.__isRewrite){window.__isRewrite=!0;var n=HTMLElement.prototype.remove;HTMLElement.prototype.remove=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i(this),this.$cache.removing||(this.$cache.removing=!0,this.onUpdate&&this.$cache.isListenUpdate&&o.listens.delete(this.$cache),this.onRemove&&(this.onRemove(this.$cache.lastMemo,this),this.onRemove=void 0),this.$cache.childs.forEach(function(e){e.remove()}),this.$cache.childs=null,this.$cache=null,n.call.apply(n,[this].concat(e)))},HTMLElement.prototype.removeChild=function(e){i(this),e.remove()};var t=HTMLElement.prototype.appendChild;HTMLElement.prototype.appendChild=function(e){if(i(this),i(e),e)return void 0===e.onUpdate||e.$cache.isListenUpdate||(e.$cache.isListenUpdate=!0,e.$cache.onUpdate=e.onUpdate,e.$cache.onMemo=e.onMemo,e.$cache.lastMemo=e.onMemo?e.onMemo(o.getState()):[],o.addListen(e.$cache),e.onUpdate(e.$cache.lastMemo)),t.call(this,e),this.$cache.childs.add(e),e.onAppend&&e.onAppend(e.$cache.lastMemo),this},HTMLElement.prototype.append=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return i(this),e.forEach(function(e){"object"==typeof e&&t.appendChild(e)}),this},HTMLElement.prototype.setChilds=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return i(this),this.$cache.childs.forEach(function(e){e&&e.remove&&e.remove()}),this.append.apply(this,e),this},HTMLElement.prototype.set=function(t){var n=this;return Object.keys(t).forEach(function(e){n[e]=t[e]}),this},HTMLElement.prototype.setEle=function(e){return e(this),this},HTMLElement.prototype.setAttr=function(e,t){return this.setAttribute(e,t),this},HTMLElement.prototype.setStyle=function(t){var n=this;return Object.keys(t).forEach(function(e){n.style[e]=t[e]}),this},HTMLElement.prototype.setClass=function(e){return this.setAttribute("class",e),this},HTMLElement.prototype.setRef=function(e){return"function"==typeof e?e(this):e.ref=this,this}}}();function r(e,t){return document.createElement(e,t)}var v=function(){return(v=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function a(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function y(e,t){if(!e)return null;for(var n,i=/([^=?&]+)=?([^&]*)/g,o={};n=i.exec(e);){var r=a(n[1]),s=a(n[2]);null===r||null===s||r in o||(t||(s=isNaN(Number(s))?s:Number(s)),o[r]=s)}return o}function m(e,t){void 0===t&&(t="");var n,i,o=[];for(i in"string"!=typeof t&&(t="?"),e)if(Object.prototype.hasOwnProperty.call(e,i)){if((n=e[i])||null!=n&&!isNaN(n)||(n=""),i=encodeURIComponent(i),n=encodeURIComponent(n),null===i||null===n)continue;o.push(i+"="+n)}return o.length?t+o.join("&"):""}var f=function(a){function l(e,t){var n=e+t;if(p.has(n))return p.get(n);var i=e&&e.split("/"),o=t&&t.split("/");if(!o||!i)return p.set(n,!1),!1;var r=!0;return i.forEach(function(e,t){"*"!==e&&e!==o[t]&&(r=!1)}),p.set(n,r),r}function s(){if(0<window.location.hash.length){var e=window.location.hash.split("?"),t=e[0],n=e[1],i=void 0===n?"":n;return[t.replace(u,""),i]}return[window.location.pathname,window.location.search||""]}function h(e,t){for(var n=0,i=o;n<i.length;n++){(0,i[n])(e,t,a.getState())}}function c(i,o,r){i!==a.getState().paths[a.getState().paths.length-1]&&(a.update(function(e){e.paths.push(i);var t=v({},e.history[i],o);if(e.history[i]=t,"undefined"!=typeof window&&!r&&!f){var n=m(t);window.history.pushState(null,""+u+i,""===n?""+u+i:""+u+i+"?"+n)}}),h(i,o))}function r(e,n){var t=a.getState(),i="number"==typeof e?e:t.paths.length-1,o=t.paths[i-1],r=t.history[o];a.update(function(e){for(var t=0;t<e.paths.length-i;t++)n||window.history.back(),e.history[o]={},e.paths.pop()}),h(o,r)}var p=new Map,d=new Map,u="",f=!1,o=[];if("undefined"!=typeof window){window.addEventListener("popstate",function(){var e=a.getState().paths;if(s()[0]!==e[e.length-1]){var n=!1;if(e.forEach(function(e,t){e===s()[0]&&(n=!0)}),n)r(void 0,!0);else{var t=s(),i=t[0],o=t[1];c(i,""!==o?y(o):void 0,!0)}}else h(s()[0],void 0)})}return{checkPathMatch:function(e){var t=a.getState().paths,n=e+":"+t.join(",");if(d.has(n))return d.get(n);for(var i=!1,o=0,r=0;r<t.length;r++){l(e,t[r])&&(o=r,i=!0)}var s=[l(e,t[t.length-1]),i,o];return d.set(n,s),s},init:function(e,t,n){if(void 0===n&&(n="#"),f=t||!1,u=n,a.update(function(e){e.paths=[],e.history=v({},e.history)}),console.log(a.getState()),"undefined"!=typeof window){var i=s(),o=i[0],r=y(i[1]);"/"===o||o===e?c(e,r):(c(e),c(o,r))}},listen:function(e){o.push(e)},pop:r,push:c,replace:function(i,o){var e=a.getState(),r=i||e.paths[e.paths.length-1];a.update(function(e){var t=v({},e.history[i],o);if(e.history[i]=t,e.paths[e.paths.length-1]=r,"undefined"!=typeof window){var n=m(t);window.history.replaceState(null,""+u+r,""===n?""+u+r:""+u+r+"?"+n)}}),h(r,o)}}}(o),w="block",g="block",C="absolute",M="auto",E="none";function t(e){var s=e.path,a=e.component,l=e.delay,t=e.keep,h=void 0===t||t,c=e.leaveTime,p=r("div").setAttr("route",s).setStyle({width:"100%",height:"100%",overflow:"hidden",left:"0px",top:"0px",backgroundColor:"#fff",pointerEvents:E,display:g,position:C,zIndex:1}),d={animeTimer:null,unListen:null,isRenderChild:!1,style:{},realChild:null},u=function(){var e=f.checkPathMatch(s),t=e[0],n=e[1],i=e[2];if(console.log(t,n,i,s),t)d.realChild||(void 0===l?(d.realChild=a(),p.setChilds(d.realChild),u()):a().then(function(e){d.realChild=e(),p.setChilds(d.realChild),u()})),d.isRenderChild=!0,d.style={pointerEvents:M,display:w,position:"relative",zIndex:3},p.setStyle(d.style);else{var o=h&&n,r=d.isRenderChild;void 0!==d.isRenderChild&&!0!==d.isRenderChild||(0<i&&c&&0<c?(d.style={pointerEvents:M,display:w,position:C,zIndex:w},p.setStyle(d.style),setTimeout(function(){d.isRenderChild=o,d.style={pointerEvents:E,display:g,position:C,zIndex:1},p.setStyle(d.style),r&&!d.isRenderChild?p.setChilds():r||p.setChilds(d.realChild)},c)):(d.isRenderChild=o,d.style={pointerEvents:E,display:g,position:C,zIndex:0<i?2:1},p.setStyle(d.style),r&&!d.isRenderChild?p.setChilds():r||p.setChilds(d.realChild)))}};return p.onAppend=function(){d.unListen=f.listen(u)},p.onRemove=function(){d.unListen&&d.unListen(),d.realChild=null,d.animeTimer=null},p}var s={DOM:r,store:o,Route:t,navHistory:f};e.DOM=r,e.Route=t,e.default=s,e.navHistory=f,e.store=o,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=index.js.map
